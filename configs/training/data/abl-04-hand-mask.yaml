# -----------------------------------------------------------------------------
# abl-04-hand-mask.yaml — Data config (256×256) w/ Hand-Mask Support
# -----------------------------------------------------------------------------
#  Usage:   ./scripts/train.sh -d abl-04-hand-mask
# -----------------------------------------------------------------------------
#  This config expects the following directory layout per date-range folder:
#    train/               RGB images used for training
#    train_hand_mask/     1-channel PNG masks for hands (same filenames)
#    val/                 RGB + *_mask files for validation
#    visual_test/         Optional inference set
# -----------------------------------------------------------------------------
#  For each RGB path under `train.indir` **there must be a matching** path under
#  `train.hand_mask_dir` *in the same order* so the dataloader can align them.
# -----------------------------------------------------------------------------

# @package _group_

# ── Global DataLoader params ────────────────────────────────────────────────
batch_size: 16          # GPU memory permitting; lower if OOM
val_batch_size: 16
num_workers: 4          # DataLoader workers

# ── Train split ─────────────────────────────────────────────────────────────
train:
  # RGB inputs ---------------------------------------------------------------
  indir:
    - ${location.data_root_dir}/field_thumbnail_dec12_dec21/train
    - ${location.data_root_dir}/field_thumbnail_sep01_sep03/train
  
  # Hand masks (same order as `indir`) --------------------------------------
  hand_mask_dir:
    - ${location.data_root_dir}/field_thumbnail_dec12_dec21/train_hand_mask
    - ${location.data_root_dir}/field_thumbnail_sep01_sep03/train_hand_mask

  kind: hand_mask_multi      # ← custom dataset class that merges hand-masks
  out_size: 256              # Image size fed into the network
  mask_inflation: 21         # Dilate hand masks by N pixels before merging

  # How to generate *random* inpainting masks on-the-fly ---------------------
  mask_gen_kwargs:
    irregular_proba: 1       # probability weight for free-form masks
    irregular_kwargs:
      max_angle: 4
      max_len: 200
      max_width: 100
      max_times: 5
      min_times: 1

    box_proba: 1             # weight for rectangular masks
    box_kwargs:
      margin: 10
      bbox_min_size: 30
      bbox_max_size: 150
      max_times: 4
      min_times: 1

    segm_proba: 0            # weight for segmentation-based masks (unused)

  transform_variant: distortions  # data augmentation pipeline

  dataloader_kwargs:
    batch_size: ${data.batch_size}
    shuffle: True
    num_workers: ${data.num_workers}

# ── Validation split ───────────────────────────────────────────────────────
val:
  indir:
    - ${location.data_root_dir}/field_thumbnail_dec12_dec21/val
    - ${location.data_root_dir}/field_thumbnail_sep01_sep03/val
  img_suffix: .png
  dataloader_kwargs:
    batch_size: ${data.val_batch_size}
    shuffle: False
    num_workers: ${data.num_workers}

# ── Visual-test split (optional) ───────────────────────────────────────────
visual_test:
  indir: ${location.data_root_dir}/field_thumbnail_sep01_sep03/visual_test
  img_suffix: .png
  pad_out_to_modulo: 32
  dataloader_kwargs:
    batch_size: 1
    shuffle: False
    num_workers: ${data.num_workers}